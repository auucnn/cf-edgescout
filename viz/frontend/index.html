<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>EdgeScout 观测面板</title>
    <link rel="stylesheet" href="styles.css" />
    <noscript>
      <style>
        main { display: none; }
        .noscript-warning { display: block; }
      </style>
    </noscript>
  </head>
  <body>
    <header class="app-header">
      <div class="header-text">
        <h1>EdgeScout 观测面板</h1>
        <p>实时查看 Cloudflare 边缘节点的健康状态、来源分布与趋势指标。</p>
      </div>
      <div class="header-actions">
        <button type="button" id="refresh-button" class="button button-ghost" aria-describedby="status-message">立即刷新</button>
        <button type="button" id="export-button" class="button">导出当前视图</button>
      </div>
    </header>

    <p class="noscript-warning" role="alert">
      需要启用 JavaScript 才能使用仪表板。
    </p>

    <main>
      <section class="panel filters" aria-labelledby="filters-title">
        <div class="panel-header">
          <h2 id="filters-title">筛选条件</h2>
          <p id="status-message" role="status" aria-live="polite">等待加载…</p>
          <p id="error-message" role="alert" class="hidden"></p>
        </div>
        <form class="filter-grid" aria-label="数据筛选">
          <fieldset class="source-switch" role="tablist" aria-label="数据来源">
            <legend class="visually-hidden">数据来源</legend>
            <button type="button" class="pill active" data-source="official" role="tab" aria-selected="true">官方</button>
            <button type="button" class="pill" data-source="third-party" role="tab" aria-selected="false">第三方</button>
            <button type="button" class="pill" data-source="all" role="tab" aria-selected="false">全部</button>
          </fieldset>
          <label for="region-filter">区域</label>
          <select id="region-filter" name="region" aria-label="按区域筛选">
            <option value="">全部区域</option>
          </select>
          <label for="score-min">得分下限</label>
          <input id="score-min" name="score_min" type="number" step="0.01" inputmode="decimal" placeholder="例如 0.6" aria-describedby="score-range-hint" />
          <label for="score-max">得分上限</label>
          <input id="score-max" name="score_max" type="number" step="0.01" inputmode="decimal" placeholder="例如 0.95" aria-describedby="score-range-hint" />
          <p id="score-range-hint" class="hint">留空表示无限制</p>
          <label for="search-input" class="visually-hidden">搜索节点</label>
          <input id="search-input" type="search" placeholder="搜索 IP / 节点标签" aria-label="搜索节点" autocomplete="off" />
        </form>
        <div class="pill-notice" id="mock-indicator" hidden role="status" aria-live="assertive">
          当前使用离线 mock 数据，检查 API 是否可达。
        </div>
      </section>

      <section class="panel metrics" aria-labelledby="metrics-title">
        <div class="panel-header">
          <h2 id="metrics-title">核心指标</h2>
        </div>
        <div class="metric-grid" role="list">
          <article class="metric-card" role="listitem">
            <h3>平均得分</h3>
            <p id="metric-avg">--</p>
          </article>
          <article class="metric-card" role="listitem">
            <h3>最高得分</h3>
            <p id="metric-max">--</p>
          </article>
          <article class="metric-card" role="listitem">
            <h3>最低得分</h3>
            <p id="metric-min">--</p>
          </article>
          <article class="metric-card" role="listitem">
            <h3>样本数量</h3>
            <p id="metric-total">--</p>
          </article>
        </div>
      </section>

      <section class="panel charts" aria-labelledby="charts-title">
        <div class="panel-header">
          <h2 id="charts-title">趋势与健康</h2>
        </div>
        <div class="chart-grid">
          <figure>
            <figcaption>平均得分趋势</figcaption>
            <canvas id="trend-chart" aria-label="得分趋势折线图" role="img"></canvas>
          </figure>
          <figure>
            <figcaption>组件健康雷达</figcaption>
            <canvas id="radar-chart" aria-label="组件健康雷达图" role="img"></canvas>
          </figure>
        </div>
      </section>

      <section class="panel leaderboard" aria-labelledby="leaderboard-title">
        <div class="panel-header">
          <h2 id="leaderboard-title">优选节点</h2>
          <p id="leaderboard-count">--</p>
        </div>
        <ol id="leaderboard" class="leaderboard-list" aria-live="polite"></ol>
      </section>

      <section class="panel results" aria-labelledby="results-title">
        <div class="panel-header">
          <h2 id="results-title">原始记录</h2>
        </div>
        <div class="table-wrapper" tabindex="0">
          <table>
            <thead>
              <tr>
                <th scope="col">时间</th>
                <th scope="col">来源</th>
                <th scope="col">区域</th>
                <th scope="col">得分</th>
                <th scope="col">详情</th>
              </tr>
            </thead>
            <tbody id="results-body"></tbody>
          </table>
        </div>
      </section>
    </main>

    <footer class="app-footer">
      <p>API 由 <code>cf-edgescout serve</code> 提供 · 前端支持离线 mock 调试。</p>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.5/dist/chart.umd.min.js" integrity="sha384-fq2WRWB9H2r/qdHTMYAaVj3l5nHvBv4+z1gTdIsXf7z6vQqlwvl7xmKj4Yd49nsP" crossorigin="anonymous"></script>
    <script type="module" src="js/main.js"></script>
  </body>
</html>
